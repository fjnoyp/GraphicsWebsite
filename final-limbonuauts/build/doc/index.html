<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Final-Limbonuauts: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Final-Limbonuauts
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Final-Limbonuauts Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="info"></a>
Basic Info</h1>
<p><b>Project:</b> 8-Final <br />
<b>Team:</b> Limbonuauts (Kyle Cheng) <br />
<b>Date:</b> December 2, 2014 <br />
 </p>
<h1><a class="anchor" id="gameplay"></a>
Description of Gameplay Mechanics</h1>
<p>The game is 2d multiplayer platformer game. I was inspired by Awesomenauts and the quick melee and shoot 2d platform action in its online multiplayer matches.</p>
<p> <table style='display:inline-table;' cellspacing='2' cellpadding='0' border='0'><tr><td align='center'><a href='Awesomenauts.jpg'><img src='Awesomenauts.jpg' border='1' height='120'></img></a></td></tr><tr><td align='center'><b> http://www.thegamescabin.com/review-awesomenauts-possibly-best-multiplayer-game-ever/</b></td></table> <script>document.write('<div style=\'display: none; visibility: hidden;\'>');</script>  </p><div class="image">
<img src="Awesomenauts.jpg" alt="Awesomenauts.jpg"/>
</div>
<p>  <script>document.write('</div>');</script> </p>
<p>I was also inspired by the destructible terrain system in the worms game series and how the levels changed over the course of the game as a result of the battle.  <table style='display:inline-table;' cellspacing='2' cellpadding='0' border='0'><tr><td align='center'><a href='Worms.jpg'><img src='Worms.jpg' border='1' height='120'></img></a></td></tr><tr><td align='center'><b> http://la.cdnmob.org/iphonegame_img/worms/real/1_worms.jpg</b></td></table> <script>document.write('<div style=\'display: none; visibility: hidden;\'>');</script>  </p><div class="image">
<img src="Worms.jpg" alt="Worms.jpg"/>
</div>
<p>  <script>document.write('</div>');</script> </p>
<p>The player controls a wizard who can wield a variety of spells. He can shoot fireballs that blow up and destroy the environment and ice spikes and glowing balls that slow the enemy. He also has the ability to quickly “blink” between locations in the map - provided that he has a clear line of site between locations. Finally, players can also create magical barriers that block projectiles and players. All of these spells deplete your mana, which slowly regenerates over time. The goal of the game is to kill the enemy player. This can be done by pushing him off of cliffs or by killing him with your spells. Players have health that regenerates slowly over time when lowered. Vegetation and hide spots can be found in the map which allow the sneaky player to surprise his opponent.</p>
<p> <table style='display:inline-table;' cellspacing='2' cellpadding='0' border='0'><tr><td align='center'><a href='Screenshot.png'><img src='Screenshot.png' border='1' height='120'></img></a></td></tr><tr><td align='center'><b> Start</b></td></table> <script>document.write('<div style=\'display: none; visibility: hidden;\'>');</script>  </p><div class="image">
<img src="Screenshot.png" alt="Screenshot.png"/>
</div>
<p>  <script>document.write('</div>');</script> </p>
<p> <table style='display:inline-table;' cellspacing='2' cellpadding='0' border='0'><tr><td align='center'><a href='ExplosionExample.png'><img src='ExplosionExample.png' border='1' height='120'></img></a></td></tr><tr><td align='center'><b> Explosions</b></td></table> <script>document.write('<div style=\'display: none; visibility: hidden;\'>');</script>  </p><div class="image">
<img src="ExplosionExample.png" alt="ExplosionExample.png"/>
</div>
<p>  <script>document.write('</div>');</script> </p>
<p> <table style='display:inline-table;' cellspacing='2' cellpadding='0' border='0'><tr><td align='center'><a href='SpikesExample.png'><img src='SpikesExample.png' border='1' height='120'></img></a></td></tr><tr><td align='center'><b> Example spell - spike spell</b></td></table> <script>document.write('<div style=\'display: none; visibility: hidden;\'>');</script>  </p><div class="image">
<img src="SpikesExample.png" alt="SpikesExample.png"/>
</div>
<p>  <script>document.write('</div>');</script> </p>
<p> <table style='display:inline-table;' cellspacing='2' cellpadding='0' border='0'><tr><td align='center'><a href='Blink.png'><img src='Blink.png' border='1' height='120'></img></a></td></tr><tr><td align='center'><b> Example spell - blink spell</b></td></table> <script>document.write('<div style=\'display: none; visibility: hidden;\'>');</script>  </p><div class="image">
<img src="Blink.png" alt="Blink.png"/>
</div>
<p>  <script>document.write('</div>');</script> </p>
<h1><a class="anchor" id="system"></a>
System Overview And Major Problems</h1>
<h2><a class="anchor" id="intro"></a>
Quick Note:</h2>
<p>(note this overview assumes basic familiarity with multiplayer synchronization issues, these details can be found in the powerpoint)</p>
<h2><a class="anchor" id="unity"></a>
System Architecture and Unity</h2>
<p>Unity encourages games that are built using a component-based architecture. Using this approach, we define an object’s behavior by attaching different components - scripts, colliders, rigidbodies that then define a specific objects’ attributes. This system avoids the use of restrictive hierarchies and makes each script/component independent from each other. Therefore, most of the scripts I created only encode for a specific behavior. Unity implicitly manages the general overall system (physics system, using my scripts to change an object’s behavior, visual display, etc.)</p>
<h2><a class="anchor" id="pun"></a>
Multiplayer and PUN (Photon Unity Networking)</h2>
<p>The software package involves the use of PhotonViews that synch information specified by the user every 100 ms (roughly) and RPC calls that allow for methods on one client to call methods on another client. The package provides a library for connecting players together so I did not need to worry about connecting players together.</p>
<h2><a class="anchor" id="playerMovement"></a>
Synchronizing Player Movement</h2>
<p>The current system works by using linear interpolation adapted from PUN’s tutorial scripts. Player A stores the movement information from Player B’s PhotonView in a circular buffer. Movement information is only used when the information is 100 ms (or older) in the past - information received at an earlier date is ignore. The purpose of this is to ensure smooth interpolation between past locations where Player B was. If we were to interpolate Player B’s position based on the last and current states received, the movement we interpolate would be subject to fluctuations in network transmit times. By only interpolating from some old player state to its 100 ms old state (and hoping that player state doesn’t take more than 100 ms to reach us) we are able to perfectly interpolate from some old state (200 ms in the past maybe) to the 100 ms in the past state. PlayerNetwork.cs manages this behavior.</p>
<p>PUN’s website - I downloaded the scripts from Unity’s Asset store <a href="https://www.exitgames.com/en/PUN">https://www.exitgames.com/en/PUN</a></p>
<h2><a class="anchor" id="playerAttack"></a>
Synchronizing Player Attack</h2>
<p>Using a PhotonView to constantly synchronize a bullet’s position across both client spaces would quickly result in network overload. Instead, I used a system described in the Skynet tutorial. All clients know how to instantiate some common projectile A. In order to create a bullet in both clients the shooting client A need only call the RPC method “make projectile” in client B. Since the bullets are not being manually synched over time, we rely on PhotonNetwork.Time as a guaranteed synched time variable across all clients. The clients then simulate the bullet’s position as a function of PhotonNetwork.Time. Therefore whenever the RPC method “make projectile” is called, we pass the timestamp when that projectile was created. Using this system, clients can be authoritative for when bullets hit themselves, thereby avoiding the need for a server (we therefore have a peer to peer system). In order to allow one client to delete projectiles created in another client, each projectile is given a unique id. To delete a projectile in another client, you send the projectile id. <a class="el" href="_ranged_attack_8cs.html">RangedAttack.cs</a> creates the projectiles and <a class="el" href="_base_projectile_8cs.html">BaseProjectile.cs</a> manages the actual spawned projectile.</p>
<p>Skynet Tutorial Links <a href="http://forum.unity3d.com/threads/new-photon-unity-networking-tutorial-series.241158/">http://forum.unity3d.com/threads/new-photon-unity-networking-tutorial-series.241158/</a></p>
<p>However, a problem they did not cover was with bullet spawn - tunneling. This occurs when the synch time causes a bullet shot from client A to spawn at a much farther distance in client B’s space. This is unavoidable - we are always playing against past player states of the other clients. To avoid the inevitable tunneling issues when projectiles are shot at close range, I raycast from the start position of the bullet to its current position (based on PhotonNetwork.time), if our client character is hit by the raycast we know that lag caused the projectile to spawn past the character. We rectify this by registering a collision with the bullet.</p>
<p>Another problem is with view inconsistency. In the above implementation the clients are only responsible for bullet collisions with themselves, client A cannot tell client B that it was hit by A’s projectiles. This is problematic due to synch time issues. A fast moving projectile shot by A will seemingly go through A’s view of B’s position because any shot registered in client B needs to call an RPC method in client A to notify A of the explosion in the first place. I kind of cheated here and in practice this cheat works quite well. When Player A shoots a projectile it only instantiates said projectile 100 ms afterwards. However, it calls the RPC “create projectile” to the other client B. The end result is that A sees his projectile 100 ms in the past. When client B registers a hit and tells client A, it takes on average 100 ms for that information to be sent. Therefore, if client A sees his projectile 100 ms in the past, and then receives the RPC call “projectile hit” from client B, A’s view of the projectile should be at a position right at or before its view of client B’s position. Without this tweak, the projectile would have most certainly passed B’s position when B’s “projectile hit” method call arrives. I tested this tweak and noticed a significant improvement in view synchronization (seeming, as everything is fake/wrong here).</p>
<p>The melee system works differently. I originally tried to make a melee attack shoot a projectile with a very short lifetime but this did not work as synch time alone would mean that most projectiles would have already expired by the time their RPC create command reached the other client. Instead I opted for raycasting and made the attacking character authoritative on hits. The problem here is that the attacked player might move out of the way of a melee attack only to die because their “past version” was in the way of the other player’s sword. In practice I have never noticed this issue due to the rarity of melee attacks and the fact that most players aren’t running away when the other player melee them. <a class="el" href="_melee_attack_8cs.html">MeleeAttack.cs</a> handles this behavior.</p>
<h2><a class="anchor" id="attackEffects"></a>
Synched Attack Effects</h2>
<p>Effects can range from slowing down a character, blinding them temporarily, pushing them back, and doing damage to their health. Having to transmit this all over the network is costly so instead a synched class (<a class="el" href="class_ranged_attack.html">RangedAttack</a>) takes in an abstract class “AbObjectEffect.cs” which it calls on the object its projectiles hit. Since this information is present in both clients we then only need to have an RPC method that calls DoEffect(Position, Direction).</p>
<h2><a class="anchor" id="terrain"></a>
Synched Static Destructible Terrain</h2>
<p>I represent the terrain as a polygon and visualize it in the game by generating a mesh (<a class="el" href="_s_destructable_8cs.html">SDestructable.cs</a>). The destroyed terrain is synched across clients by the explosion calls. Projectiles that destroy the environment have a script “EffectObjectInArea.cs” that spawns a collider and destroys any collided objects that have the “DesEnviro” tag attached to themselves. This method is an RPC call so it is executed across all clients at the same location and rotation (hence the reason that the terrain is static and only destructible).</p>
<p>I represent the terrain as a polygon and visualize it in the game by generating a mesh (<a class="el" href="_s_destructable_8cs.html">SDestructable.cs</a>). The destroyed terrain is synched across clients by the explosion calls. Projectiles that destroy the environment have a script “EffectObjectInArea.cs” that spawns a collider and destroys any collided objects that have the “DesEnviro” tag attached to themselves. This method is an RPC call so it is executed across all clients at the same location and rotation (hence the reason that the terrain is static and only destructible).</p>
<h1><a class="anchor" id="gameplayFilm"></a>
Gameplay Trailer</h1>
<p> <table style='display:inline-table;' cellspacing='2' cellpadding='0' border='0'><tr><td align='center'><a href='limbonuauts-final-gameplay-film.mp4'><div style='border: 1px solid #00F; width: 180px; height: 120px; background: #222; color: #AAA; text-align: center;'><span style='position: relative; top: 40px; font-size: 100px; '>&#9654;</span><br></br><span style='position: relative; top: 30px;'>Play Video</span></div></a></td></tr><tr><td align='center'><b> GameplayTrailer</b></td></table> </p><div style="display: none; visibility:hidden"> <div class="image">
<img src="limbonuauts-final-gameplay-film.mp4" alt="limbonuauts-final-gameplay-film.mp4"/>
</div>
 </div><h1><a class="anchor" id="trailerFilm"></a>
Trailer</h1>
<p> <table style='display:inline-table;' cellspacing='2' cellpadding='0' border='0'><tr><td align='center'><a href='limbonuauts-final-trailer-film.mp4'><div style='border: 1px solid #00F; width: 180px; height: 120px; background: #222; color: #AAA; text-align: center;'><span style='position: relative; top: 40px; font-size: 100px; '>&#9654;</span><br></br><span style='position: relative; top: 30px;'>Play Video</span></div></a></td></tr><tr><td align='center'><b> Trailer</b></td></table> </p><div style="display: none; visibility:hidden"> <div class="image">
<img src="limbonuauts-final-trailer-film.mp4" alt="limbonuauts-final-trailer-film.mp4"/>
</div>
 </div><h1><a class="anchor" id="credit"></a>
Credits</h1>
<p>Thanks to Devin, Yitong, Karen, and Michael for playtesting the game with me!</p>
<p>I would also like to thank the online community for the helpful articles and tutorials they provided.</p>
<p>Particularly Skynet for the multiplayer tutorials: <a href="http://forum.unity3d.com/threads/new-photon-unity-networking-tutorial-series.241158/">http://forum.unity3d.com/threads/new-photon-unity-networking-tutorial-series.241158/</a></p>
<p>PUN for their Marco Polo Tutorial (download available on Unity Asset Store)</p>
<p>And some other online authors (please note this is not exhaustive) <a href="http://gafferongames.com/game-physics/fix-your-timestep/">http://gafferongames.com/game-physics/fix-your-timestep/</a> <a href="http://answers.unity3d.com/questions/417478/best-way-to-make-a-multiplayer-physics-heavy-game.html">http://answers.unity3d.com/questions/417478/best-way-to-make-a-multiplayer-physics-heavy-game.html</a> <a href="http://joostdevblog.blogspot.com/2014/09/the-importance-of-packet-count.html">http://joostdevblog.blogspot.com/2014/09/the-importance-of-packet-count.html</a></p>
<p>See our <a class="el" href="_journal.html">Development Journal </a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Dec 10 2014 18:12:32 for Final-Limbonuauts by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
